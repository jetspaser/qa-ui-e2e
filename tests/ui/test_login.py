

"""
UI-тесты для аутентификации в YouTrack.

Данный модуль содержит базовый end-to-end тест,
который проверяет успешный вход пользователя через UI.
"""

from playwright.sync_api import Page, expect


def test_login_success(page: Page) -> None:
    """
    Проверяет, что пользователь может успешно войти в YouTrack
    с использованием валидных учетных данных.

    Шаги теста:
    1. Открыть страницу логина
    2. Заполнить поле логина
    3. Заполнить поле пароля
    4. Нажать кнопку «Войти»
    5. Убедиться, что открылась главная страница:
       - Фирменный логотип отображается
       - Заголовок страницы соответствует ожидаемому
    """

    # --- Шаг 1: Открыть страницу ---
    # В YouTrack при наличии активной сессии
    # пользователь может быть автоматически перенаправлен
    # сразу на главную страницу без формы логина.
    page.goto("http://localhost:8080/")

    # --- Шаг 2: Заполнить поле логина ---
    # locator() создает "ленивый" объект Locator:
    # реальный поиск элемента происходит в момент действия (fill).
    page.locator('[data-test="username-field"]').fill("admin")

    # fill():
    # - ожидает, пока элемент станет видимым
    # - очищает текущее значение
    # - вводит указанный текст

    # --- Шаг 3: Заполнить поле пароля ---
    page.locator('[data-test="password-field"]').fill("admin")

    # --- Шаг 4: Нажать кнопку «Войти» ---
    page.locator('[data-test="login-button"]').click()

    # click():
    # - ожидает, пока элемент станет доступен для взаимодействия
    # - выполняет клик
    # - автоматически ожидает навигацию, если она происходит

    # --- Шаг 5.1: Проверить, что логотип YouTrack отображается ---
    # Проверка по логотипу подтверждает,
    # что пользователь действительно находится в интерфейсе YouTrack.
    expect(
        page.locator('img[src*="youtrack-wide"]')
    ).to_be_visible()

    # to_be_visible():
    # - элемент присутствует в DOM
    # - элемент не скрыт стилями
    # - элемент имеет ненулевые размеры

    # --- Шаг 5.2: Проверить заголовок страницы ---
    # Проверка document.title используется здесь осознанно:
    # в YouTrack заголовок панели может присутствовать
    # в нескольких элементах DOM, что вызывает strict mode ошибки
    # при проверке через локаторы.
    expect(page).to_have_title(
        "YouTrack Default Панель мониторинга"
    )

    # to_have_title():
    # - ожидает, пока document.title станет равен ожидаемому значению
    # - подтверждает успешную навигацию после логина
